---
- job:
    name: validations-common-functional
    parent: devstack
    run: playbooks/validations-common-functional.yaml
    post-run: playbooks/post.yaml
    timeout: 7200
    required-projects:
      - openstack/validations-libs
      - openstack/validations-common
      - name: openstack/openstacksdk
        override-checkout: master
      - name: opendev.org/openstack/devstack
        override-checkout: master
    vars:
      devstack_localrc:
        USE_PYTHON3: true
      run_validation: true
    irrelevant-files:
      - ^.*\.rst$
      - ^doc/.*$
      - ^releasenotes/.*$

- job:
    name: validations-common-functional-stable
    parent: validations-common-functional
    branches: stable/1.6
    override-checkout: stable/train
    required-projects:
      - name: openstack/requirements
        override-checkout: stable/train
      - openstack/validations-libs
      - openstack/validations-common
      - name: openstack/openstacksdk
        override-checkout: stable/train
      - name: opendev.org/openstack/devstack
        override-checkout: stable/train

- job:
    name: validations-common-reqcheck
    nodeset: centos-8-stream
    parent: base
    run: playbooks/reqcheck.yaml
    timeout: 1600
    voting: true
    override-checkout: stable/train
    required-projects:
      - openstack/validations-common
    files:
      - ^requirements.txt$

- job:
    description: Base validations-common job
    name: validations-common-centos-8-base
    nodeset: centos-8-stream
    parent: base
    success-url: "reports.html"
    failure-url: "reports.html"
    pre-run:
      - tests/prepare-test-host.yml
      - playbooks/molecule/pre.yml
    run:
      - playbooks/molecule/run.yml
    timeout: 1800
    voting: true

- job:
    name: validations-common-centos-8-base-stable
    nodeset: centos-8-stream
    parent: validations-common-centos-8-base
    description: |
      Base job for validations-common molecule tests, adjusted to work
      with stable/1.6 branch of the openstack/validations-common repository and
      stable/train branches of other Openstack projects.
      This job should not be used for any other purpose.
    branches: stable/1.6
    override-checkout: stable/train
    vars:
      branch_override: stable/train

- job:
    name: tripleo-ci-centos-8-standalone-validation-common
    parent: tripleo-ci-base-standalone-centos-8
    vars:
      featureset: '052'
      validate_services: true
      enable_validation: true
      validation_component: validation
      build_container_images: true

- job:
    name: tripleo-ci-centos-8-standalone-validation-common-stable
    parent: tripleo-ci-centos-8-standalone-validation-common
    description: |
      Standalone job created and intended solely for the stable/1.6
      branch of the openstack/validations-common project.
      Checks out stable/train branches of relevant openstack repos in order
      to test mutual compatibility of validations-common-1.6.* and Train release
      of Openstack project. This job should not be used for any other purpose.
    final: true
    branches: stable/1.6
    override-checkout: stable/train
    required-projects:
      name: openstack/tripleo-ci
      override-checkout: master
    vars:
      branch_override: stable/train

- job:
    name: validations-common-openstack-tox-linters-ubuntu-focal
    nodeset: ubuntu-focal
    parent: openstack-tox-linters

- job:
    name: validations-common-openstack-tox-cover-ubuntu-focal
    nodeset: ubuntu-focal
    parent: openstack-tox-cover

- job:
    name: validations-common-openstack-tox-docs-ubuntu-focal
    nodeset: ubuntu-focal
    parent: openstack-tox-docs

- project:
    templates:
      - check-requirements
      - validations-common-molecule-jobs
    check:
      jobs:
        - validations-common-reqcheck
        - validations-common-openstack-tox-linters-ubuntu-focal: &tox_override_checkout
            override-checkout: stable/train
        - validations-common-openstack-tox-cover-ubuntu-focal: *tox_override_checkout
        - openstack-tox-py36: *tox_override_checkout
        - openstack-tox-py37: *tox_override_checkout
        - validations-common-functional-stable
        - tripleo-ci-centos-8-standalone-validation-common-stable:
            dependencies:
              - validations-common-openstack-tox-linters-ubuntu-focal
              - validations-common-openstack-tox-cover-ubuntu-focal
              - validations-common-functional-stable
        - validations-common-openstack-tox-docs-ubuntu-focal: &tripleo-docs
            <<: *tox_override_checkout
            files:
              - ^doc/.*
              - ^README.rst
              - ^validations_common/.*
    gate:
      jobs:
        - validations-common-openstack-tox-linters-ubuntu-focal: *tox_override_checkout
        - openstack-tox-py36: *tox_override_checkout
        - openstack-tox-py37: *tox_override_checkout
        - validations-common-functional-stable
        - tripleo-ci-centos-8-standalone-validation-common-stable:
            dependencies:
              - validations-common-openstack-tox-linters-ubuntu-focal
              - validations-common-functional-stable
        - validations-common-openstack-tox-docs-ubuntu-focal: *tripleo-docs
    promote:
      jobs:
        - promote-openstack-tox-docs:
            files:
              - ^doc/.*
              - ^README.rst
              - ^validations_common/.
- project-template:
    check:
      jobs:
        - validations-common-centos-8-molecule-advanced_format_512e_support
        - validations-common-centos-8-molecule-check_latest_packages_version
        - validations-common-centos-8-molecule-dns
        - validations-common-centos-8-molecule-ntp
        - validations-common-centos-8-molecule-service_status
        - validations-common-centos-8-molecule-check_cpu
        - validations-common-centos-8-molecule-check_disk_space
        - validations-common-centos-8-molecule-check_ram
        - validations-common-centos-8-molecule-check_selinux_mode
        - validations-common-centos-8-molecule-validate_selinux
        - validations-common-centos-8-molecule-xfs_check_ftype
        - validations-common-centos-8-molecule-check_rsyslog
    gate:
      jobs:
        - validations-common-centos-8-molecule-check_latest_packages_version
        - validations-common-centos-8-molecule-dns
        - validations-common-centos-8-molecule-check_cpu
        - validations-common-centos-8-molecule-check_disk_space
        - validations-common-centos-8-molecule-check_ram
        - validations-common-centos-8-molecule-validate_selinux
    name: validations-common-molecule-jobs

- job:
    files:
      - ^validations_common/roles/check_selinux_mode/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-check_selinux_mode
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: check_selinux_mode
    voting: false
- job:
    files:
      - ^validations_common/roles/ntp/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-ntp
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: ntp
    voting: false
- job:
    files:
      - ^validations_common/roles/service_status/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-service_status
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: service_status
    voting: false
- job:
    files:
      - ^validations_common/roles/advanced_format_512e_support/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-advanced_format_512e_support
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: advanced_format_512e_support
    voting: false
- job:
    files:
      - ^validations_common/roles/dns/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-dns
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: dns
- job:
    files:
      - ^validations_common/roles/check_cpu/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-check_cpu
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: check_cpu
- job:
    files:
      - ^validations_common/roles/check_ram/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-check_ram
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: check_ram
- job:
    files:
      - ^validations_common/roles/check_disk_space/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-check_disk_space
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: check_disk_space
- job:
    files:
      - ^validations_common/roles/xfs_check_ftype/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-xfs_check_ftype
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: xfs_check_ftype
    voting: false
- job:
    files:
      - ^validations_common/roles/check_latest_packages_version/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-check_latest_packages_version
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: check_latest_packages_version
- job:
    files:
      - ^validations_common/roles/validate_selinux/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-validate_selinux
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: validate_selinux
- job:
    files:
      - ^validations_common/roles/check_rsyslog/.*
      - ^tests/prepare-test-host.yml
      - ^playbooks/molecule/pre.yml
      - ^playbooks/molecule/run.yml
      - ^molecule-requirements.txt
    name: validations-common-centos-8-molecule-check_rsyslog
    parent: validations-common-centos-8-base-stable
    vars:
      validations_common_role_name: check_rsyslog
